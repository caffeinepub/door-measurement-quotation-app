{
  "kind": "build_request",
  "title": "Refactor door quotation to use size-based grouping with coating columns",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-31",
      "text": "Change door count logic to count only unique door sizes (height × width combinations). Multiple coating selections on the same size must count as a single door.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Door count must be based ONLY on unique door SIZE. Multiple coating selections on same size must NOT increase door count. Example: 78 x 36 with 4 coatings = 1 door"
        ]
      },
      "acceptanceCriteria": [
        "A door with height 78 and width 36 with 4 different coatings selected counts as 1 door",
        "Door count increments only when a new unique size combination is added",
        "Backend groups entries by size and aggregates coatings per size"
      ]
    },
    {
      "id": "REQ-32",
      "text": "Replace the current door entries table structure with a new format having columns: Sr No | Size | Single Coating | Double Coating | Double Coating + Sagwan Patti | Laminate | Sq.Ft. Each row represents ONE unique door size with coating amounts shown in separate columns.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Replace current door entries table with: Columns: Sr No | Size | Single Coating | Double Coating | Double Coating + Sagwan Patti | Laminate | Sq.Ft. Each row = ONE door size. Each coating amount shown in its own column"
        ]
      },
      "acceptanceCriteria": [
        "Table displays one row per unique door size",
        "Each coating type has its own column showing the calculated amount",
        "If a coating is not selected for a size, its column shows a dash or remains empty",
        "Size column displays format like '78 × 36'",
        "Sq.Ft column shows the square footage for that size"
      ]
    },
    {
      "id": "REQ-33",
      "text": "Remove all rate (₹/sq.ft) displays from the UI and PDF. Show only the final calculated amounts per coating type without showing the rate used for calculation.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Do NOT show rate (₹/sq.ft) anywhere in UI or PDF. Only final calculated amount per coating."
        ]
      },
      "acceptanceCriteria": [
        "Rate field is not visible in the door entries table",
        "Rate is not shown in the PDF quotation",
        "Only coating amounts are displayed, not the rate used to calculate them"
      ]
    },
    {
      "id": "REQ-34",
      "text": "Update the totals section to show only Total Square Feet and separate totals for each coating type (Single Coating, Double Coating, Double Coating + Sagwan Patti, Laminate). Remove Grand Total and Total Quantity displays.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Remove: Grand Total, Total Quantity. Show ONLY: Total Square Feet, Separate total for each coating type"
        ]
      },
      "acceptanceCriteria": [
        "Totals section displays Total Square Feet",
        "Separate total amounts shown for each coating type (4 coating totals)",
        "Grand Total amount is not displayed",
        "Total Quantity field is not displayed",
        "Backend provides separate totals per coating type"
      ]
    },
    {
      "id": "REQ-35",
      "text": "Update the square footage calculation formula to: Sq.Ft = (Rounded Height × Rounded Width) / 144. Update amount calculation to: Amount per coating = Sq.Ft × respective coating rate.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Sq.Ft = (Rounded Height × Rounded Width) / 144. Amount per coating: Sq.Ft × respective coating rate"
        ]
      },
      "acceptanceCriteria": [
        "Square feet calculated using (Rounded Height × Rounded Width) / 144",
        "Each coating amount calculated as Sq.Ft × coating rate (165, 185, 210, or 240)",
        "Calculations match the specified formula exactly"
      ]
    },
    {
      "id": "REQ-36",
      "text": "Ensure the new table layout and totals structure are consistent between the app preview UI and the generated PDF quotation.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Ensure same layout and logic in: App preview, Generated PDF"
        ]
      },
      "acceptanceCriteria": [
        "PDF displays the same table structure with Sr No | Size | coating columns | Sq.Ft",
        "PDF totals section matches the UI totals section (Total Sq.Ft + coating totals)",
        "Formatting and data presentation are identical between UI and PDF"
      ]
    },
    {
      "id": "REQ-37",
      "text": "Update the confirmation message after quotation generation to display 'Quotation generated for X door size(s).' where X is the count of unique door sizes (not total entries).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Display message: 'Quotation generated for 1 door size.'"
        ]
      },
      "acceptanceCriteria": [
        "Message shows actual count of unique door sizes",
        "Message format is 'Quotation generated for 1 door size.' for single size",
        "Message format is 'Quotation generated for X door sizes.' for multiple sizes",
        "Message appears after successful PDF generation"
      ]
    },
    {
      "id": "REQ-38",
      "text": "Refactor the backend data model to group door entries by unique size (height × width) and store coating selections as properties of each size group rather than separate entries.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Each row = ONE door size. Each coating amount shown in its own column"
        ]
      },
      "acceptanceCriteria": [
        "Backend stores one record per unique door size",
        "Each size record contains coating selections as separate fields or a map",
        "Querying entries returns data grouped by size with coating amounts",
        "Adding a door with existing size updates that size's coating selections"
      ]
    }
  ],
  "constraints": [
    "Do not change the backend single-actor architecture",
    "Maintain existing rounding logic for height (72/75/78/80/84) and width (30/32/34/36/38/40/42/48)",
    "Preserve existing coating rates: Single Coating (165), Double Coating (185), Double Coating + Sagwan Patti (210), Laminate (240)",
    "Keep the auto-clear functionality after quotation generation",
    "Maintain Indian Rupee (₹) symbol and comma formatting for currency"
  ],
  "nonGoals": [
    "Changing the customer information form fields",
    "Modifying the WhatsApp sharing functionality",
    "Altering the theme toggle or dark/light mode implementation",
    "Changing the door type selection UI (checkboxes remain)",
    "Modifying the height/width input fields or rounding rules"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}